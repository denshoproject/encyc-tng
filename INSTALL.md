# Installing encyc-tng


## Prerequisites

Before you do anything else you have to install `make` and `git`:
``` bash
sudo apt install build-essential git
```


## Install the `encyc-tng` source code

``` bash
git clone git@github.com:denshoproject/encyc-tng
# or
git clone https://github.com/denshoproject/encyc-tng

sudo mv encyc-tng /opt/
cd /opt/encyc-tng
sudo make install
```

Application default settings are in `/etc/encyc/encyctng.cfg`.  Please do not edit this file.  Make configuration changes to `/etc/encyc/encyctng-local.cfg`.

Commands that are "run as the `encyc` user" assume that you are `encyc` and that you have activated the Python virtual environment:
``` bash
cd /opt/encyc-tng
sudo su encyc
source venv/encyctng/bin/activate
```


## Database Setup

`encyc-tng` is intended for use with a PostgreSQL database.  Installation and configuration of PostgreSQL is beyond the scope of this document.  Once you have it set up, log in using `psql` and set up the database:
``` sql
CREATE DATABASE encyctng;
CREATE USER encyctng WITH PASSWORD 'REDACTED';
ALTER DATABASE encyctng OWNER TO encyctng;
\connect encyctng;
GRANT CREATE ON SCHEMA public TO encyctng;
\q
```

If you are unable to set up PostgreSQL and wish to use SQLite3, first create a `db/` directory and make it writable by the `encyc` user:
``` bash
cd /opt/encyc-tng
sudo mkdir db
sudo chown encyc:encyc db/
```
Then edit `/etc/encyc/encyctng-local.cfg` and set the following values:
``` ini
[database]
engine=django.db.backends.sqlite3
name=/opt/encyc-tng/db/encyctng.sqlite3
host=
port=
username=
password=
```


## Application Setup

Once your database is set up, create database tables and your superuser (run as `encyc`):
``` bash
python encyctng/manage.py migrate
python encyctng/manage.py createsuperuser
```


## Run the application
``` bash
python encyctng/manage.py runserver 0.0.0.0:8000
```
